{% extends 'homepage.html' %}
{% block content %}

{% if not user.is_authenticated %}

  <h1>You are not logged in</h1>

  <form name="login" action="{{ url_for('.login') }}" method="POST">
    <input type="hidden" name="next" value="{{ next }}" />
    <table>
      <tr><td>Kerb ID:</td>
        <td><input name="identifier" placeholder="roed" /></td></tr>
{#
      <tr><td>Password:</td>
          <td><input name="password" type="password" /></td>
          <td> (<a href="{{ url_for('.reset_password') }}">Forgot password?</a>) </td>
      </tr>
#}
      <tr>
        <td></td>
        <td><button class="save" name="submit" type="submit">Login</button></td>
      </tr>
    </table>
  </form>

{% else %}
  <form action="{{ url_for('.logout') }}" method="POST" name="logout">
  <h2>You are logged in as {{ user.preferred_names }}<div style="float: right; margin-right: 50px"><button name="logout" type="submit">Logout</button></div></h2>
  </form>

  <h3>Classes</h3>

  <form action="{{ url_for('.set_info') }}" method="post" name="userinfo">
  <h3>Personal details</h3>

  <table>
    <tr>
      <td class="caption">Preferred name</td>
      <td><input class="value" name="preferred_names" value="{{user.preferred_names}}" tabindex="1" required /></td>
    </tr>
    <tr>
      <td class="caption">Preferred pronouns</td>
      <td><input class="value" name="preferred_pronouns" value="{{user.preferred_pronouns}}" tabindex="2" /></td>
    </tr>
    {# May eventually add dorm + radius #}
    {# Unclear what to do with gender #}
  </table>

  <h3>Availability this term</h3>
  <input id="num_slots" name="num_slots" style="display:none;" value="{{ user.preferences.time_slots|length }}">
  <table class="times" min-width="580px;">
    <tr>
      <td class="caption">Time zone</td>
      <td><select class="value" name="timezone">
            {% for tz, pretty_tz in [('', 'Browser time zone')] + options["timezones"] %}
            <option value="{{tz}}" {% if tz == user.timezone %} selected=true {%endif%}>{{pretty_tz}}</option>
            {% endfor %}
          </select>
      </td>
    </tr>
    {% for i in range(maxlength["time_slots"]//2) %}
      <tr>
        {% if i == 0 %}
          {% set hide="visibility:hidden;" %}
          <td class="caption"><a>Time slots</a>
          <a class="slotplus" id="slotplus" style="{{hide}}" href="#"><i style="color:green;" class="fas fa-plus-square"></i></a>
          <a class="slotminus" id="slotminus" style="{{hide}}" href="#"><i style="color:darkred;" class="fas fa-minus-square"></i></a>
          </td>
        {% else %}
          {% set hide="display:none;" %}
          <td></td>
        {% endif %}
        {% for j in range(2) %}
          <td style="padding-right:1px; margin-right:0px;">
            <select id="weekday{{2*i+j}}" name="weekday{{2*i+j}}" style="{{hide}}">
              <option value="" {% if user.preferences.weekdays[2*i+j] is none %} selected{% endif %}></option>
              {% for wkday in options["weekday"] %}
                <option value="{{loop.index0}}"{% if user.preferences.weekdays[2*i+j] == loop.index0 %} selected{% endif %}>{{wkday}}</option>
              {% endfor %}
            </select>
          </td>
          <td style="padding-left:1px; margin-left:0px; padding-right:33px;">
            <input id="time_slot{{2*i+j}}" name="time_slot{{2*i+j}}" value="{{ user.preferences.time_slots[2*i+j] }}" style="width:90px; {{hide}}" placeholder="15:00-16:00" />
          </td>
        {% endfor %}
      </tr>
    {% endfor %}
  </table>

  <h3>Preferences</h3>

  <table>
    <tr>
      <td class="caption">Collaboration medium</td>
      <td>
        <select class="value" name="pref_medium">
          <option value=""{% if not user.preferences.medium %} selected {% endif %}></option>
          {% for (value, display) in options["medium"] %}
          <option value="{{value}}" {% if user.preferences.medium == "{{val}}" %} selected {% endif %}>{{display}}</option>
          {% endfor %}
        </select>
      </td>
    </tr>
    <tr>
      <td class="caption">Desired group size</td>
      <td><input class="value" name="pref_group_size" value="{{ current_user.preferences.group_size }}" placeholder="2-3" /></td>
    </tr>
    <tr>
      <td class="caption">When to start psetting</td>
      <td>
        <select class="value" name="pref_start">
          <option value=""{% if not user.preferences.start %} selected {% endif %}></option>
          <option value="early"{% if user.preferences.start == "early" %} selected {% endif %}>as soon as the pset is posted</option>
          <option value="mid"{% if user.preferences.start == "mid" %} selected {% endif %}>3-4 days before the due date</option>
          <option value="late"{% if user.preferences.start == "late" %} selected {% endif %}>1-2 days before the due date</option>
        </select>
      </td>
    </tr>
    <tr>
      <td class="caption">How you like to collaborate</td>
      <td>
        <select class="value" name="pref_together">
          <option value=""{% if not user.preferences.together %} selected {% endif %}></option>
          <option value="all"{% if user.preferences.together == "all" %} selected {% endif %}>solve the problems together</option>
          <option value="stuck"{% if user.preferences.together == "stuck" %} selected {% endif %}>brainstorm ideas, help each other when stuck</option>
          <option value="apart"{% if user.preferences.together == "apart" %} selected {% endif %}>work independently and sanity check answers</option>
        </select>
      </td>
    </tr>
  </table>

  <button type="submit" name="submit" value="save">Save</button>
  </form>

<script type="text/javascript">
  var max_slots = {{ maxlength["time_slots"] }};
  document.addEventListener("DOMContentLoaded", function() {
    setupslots();
  });
</script>

{% endif %}

{% endblock %}
