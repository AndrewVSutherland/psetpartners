<!-- jshint ignore:start -->
{% extends 'homepage.html' %}

{% block content %}

{% if not user.is_authenticated %}

<h3>User "{{user.kerb}}" not authenticated.</h3>

This is a bug, please report is to <a href="mailto:psetpartners@mit.edu">psetpartners@mit.edu</a>.

{% else %}

<h2>{{user.preferred_name}}</h2>

{% if (user.classes|length) == 0 %}
<p>You do not have access to this site because Touchstone has not identified you as a student and you are not listed as an instructor of one of the classes using the site this term.  For the {{current_term_pretty}} term only classes in course 18 are using pset partners.</p>
<p>Please <a href="mailto:psetpartners@mit.edu">contact us</a> if this information is incorrect.</p>
<p>
If you are an instructor or staff member outside of course 18 interested in using pset partners, please contact <a href="mailto:drew@math.mit.edu">drew@math.mit.edu</a>.  We plan to expand the site beyond course 18 in the spring.
</p>
{% else %}
{% if (user.classes|length) == 1 %}
<p align="justify">According to our records, you are an instructor for <b>{{ user.classes[0]['class_number'] + " " + user.classes[0]['class_name']}}</b> this term.</p>
{% else %}
<p>According to our records, you are an instructor for the following courses this term:</p>
<ul>

{% if (user.classes|length) > 0 %}

{% for i in range(user.classes|length) %}
{% set c = user.classes[i] %}
<li style="margin:8px 0;"> <label style="color:var(--mit-maroon);" onclick="toggleClass({{i}},{{user.classes|length}});">{{ c['class_number'] + ' ' + c['class_name']  }}</label></li>
{% endfor %}
</ul>
{% endif %}
{% endif %}
{% for i in range(user.classes|length) %}
{% set c = user.classes[i] %}
<div class="class-{{i}}" {% if i > 0 %} style="display:none;" {% endif %}>
<p>
The table below lists the <b>{{c.students|length}}</b> students who have this course listed in their pset partner profile; this does not necessarily mean that they have registered for the course.
No matchings have taken place yet, so most students are not yet a mmember of a group.  The first matching is currently scheduled to take place <b>{{user.classes[0]['next_match_date']}}</b>  Group names in bold denote a public group.  Public groups and their membership are visible to all students, otherwise groups are visible only to instructors and the members of the group.
</p><p>
Please contact <a href="mailto:psetpartners@mit.edu">psetpartners@mit.edu</a> if you have any questions or concerns.
</p>
</div>
<h3 style="text-align:center; {% if i > 0 %} display:none; {% endif %}" class="class-{{i}}"> {{c['class_number'] + " " + c['class_name']}}</h3>

<table class="mtab class-{{i}}" {% if i > 0 %} style="display:none;" {% endif %}>
  <head><tr><th>name</th><th>depts</th><th>year</th><th>email</th><th>status</th><th>group</th></tr></head>
  <tbody>
  {% for s in c.students %}
    {% set y = 'G' if s['year'] == 5 else (s['year'] if s['year'] else '-') %}
    {% set name = s['full_name'] if s['full_name'] else (s['preferred_name'] if s['preferred_name'] else s['kerb']) %}
    {% set group = '<b>' + s['group_name'] + '<b>' if s['group_name'] and s['visibility'] > 1 else ( s['group_name'] if s['group_name'] else '') %}
    {% set status = s.get('status',0) %}
    {% set status = "member" if status == 1 else ("in pool" if status == 2 else ("matching") if status > 2 else "") %}
    <tr><td style="text-align:left">{{name}}</td><td>{{(s['departments']|join(",")) if s['departments'] else '-'}}</td><td>{{y}}</td><td style="text-align:right;"><a href="mailto{{s['kerb']}}@mit.edu">{{s['kerb']}}@mit.edu</a></td><td>{{status}}</td><td style="text-align:left">{{group|safe}}</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endfor %}

{% endif %}

{% endif %}

<script>
function toggleClass(i,n) {
    for (let j = 0 ; j < n ; j++ ) if ( j != i ) $('.class-'+j).hide();
    $('.class-'+i).show();
}
</script>

{% endblock %}
